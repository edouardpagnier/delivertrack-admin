<html>
    <head>
        <title>Client test</title>
    </head>
    <body>
        <a id="update_button" style="display: none;" href="javascript:launchTest()">Update coordinate</a>
        <div id="response"></div>

        <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script type="text/javascript">

            var site_url = "http://delivertrack.local/";
            var api_url = site_url + 'api/v1/';
            var token = '';
            var counter = 0;

            var coords = new Array(
                    {'lat': 37.805178, 'lng': -122.417281},
                    {'lat': 37.804720, 'lng': -122.416610},
                    {'lat': 37.804241, 'lng': -122.415923},
                    {'lat': 37.803766, 'lng': -122.415252},
                    {'lat': 37.803296, 'lng': -122.414560},
                    {'lat': 37.802830, 'lng': -122.413868},
                    {'lat': 37.802364, 'lng': -122.413160},
                    {'lat': 37.801868, 'lng': -122.412500},
                    {'lat': 37.801381, 'lng': -122.411808},
                    {'lat': 37.800885, 'lng': -122.411111},
                    {'lat': 37.800410, 'lng': -122.410419},
                    {'lat': 37.799927, 'lng': -122.409716},
                    {'lat': 37.799473, 'lng': -122.409013},
                    {'lat': 37.799621, 'lng': -122.408139},
                    {'lat': 37.799718, 'lng': -122.407420},
                    {'lat': 37.800430, 'lng': -122.407559},
                    {'lat': 37.801138, 'lng': -122.407704},
                    {'lat': 37.801863, 'lng': -122.407849},
                    {'lat': 37.802562, 'lng': -122.407994},
                    {'lat': 37.803266, 'lng': -122.408139},
                    {'lat': 37.803974, 'lng': -122.408284},
                    {'lat': 37.804682, 'lng': -122.408429},
                    {'lat': 37.805309, 'lng': -122.408568},
                    {'lat': 37.805199, 'lng': -122.409458},
                    {'lat': 37.805085, 'lng': -122.410348},
                    {'lat': 37.805000, 'lng': -122.411153},
                    {'lat': 37.804911, 'lng': -122.411786},
                    {'lat': 37.805831, 'lng': -122.411984},
                    {'lat': 37.805734, 'lng': -122.412848},
                    {'lat': 37.805615, 'lng': -122.413728},
                    {'lat': 37.805505, 'lng': -122.414608},
                    {'lat': 37.805403, 'lng': -122.415493},
                    {'lat': 37.805301, 'lng': -122.416373}
            );

            $(document).ready(function(){

                $.ajax({
                    url: api_url+'login',
                    dataType: "json",
                    type: "POST",
                    data: {"email":"francis@carne.com","password":"azerty"},
                    success: function (data) {
                        token = data.token;
                        $('#update_button').show();
                    }
                });
            });

            function launchTest(){
                    updateDriverCoordinate(coords[counter]);
            }


            function updateDriverCoordinate(latlng){
                var params = {'token': token, 'driver_id': 5, 'lat': latlng.lat, 'lng': latlng.lng};
                //console.log(api_url+'drivers/coordinates');
                //console.log(params);
                $.ajax({
                    url: api_url+'drivers/coordinates',
                    type: 'PUT',
                    data: params,
                    dataType: 'json',
                    success: function(data) {
                        $('#response').html($('#response').html()+'<br />{lat: '+latlng.lat+', lng: '+latlng.lng+'}');
                        setTimeout(function(){
                            updateDriverCoordinate(coords[counter]);
                        }, 5000);
                        if(counter == 32){
                            counter = 0;
                        }
                        else {
                            counter++;
                        }
                    }
                });
            }

            function sleep(milliseconds) {
                var start = new Date().getTime();
                for (var i = 0; i < 1e7; i++) {
                    if ((new Date().getTime() - start) > milliseconds){
                        break;
                    }
                }
            }
        </script>
    </body>
</html>
